---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import ContactSection from '../../components/ContactSection.astro';

// 1. Questa funzione magica dice ad Astro quali pagine generare
// Legge tutti i lavori dal CMS e crea un URL per ognuno.
export async function getStaticPaths() {
  const lavori = await getCollection('portfolio');
  return lavori.map((lavoro) => ({
    params: { slug: lavoro.slug },
    props: { lavoro },
  }));
}

// 2. Recuperiamo i dati del singolo lavoro
const { lavoro } = Astro.props;
// 3. Renderizziamo il testo descrittivo (Markdown) in HTML
const { Content } = await lavoro.render();
---

<Layout title={`${lavoro.data.title} - ProGreen Portfolio`}>
  <Navbar />

  <main class="pt-24"> <header class="relative h-[60vh] min-h-[400px]">
      {lavoro.data.image && (
        <div class="absolute inset-0">
          <img 
            src={lavoro.data.image} 
            alt={lavoro.data.title} 
            class="w-full h-full object-cover"
          />
          <div class="absolute inset-0 bg-stone-900/60 backdrop-blur-[2px]"></div>
        </div>
      )}
      
      <div class="relative z-10 h-full max-w-7xl mx-auto px-6 flex flex-col justify-center text-white">
        <a href="/#lavori" class="inline-flex items-center text-emerald-300 hover:text-white mb-6 transition-colors font-medium tracking-wide text-sm uppercase">
          ‚Üê Torna ai Lavori
        </a>
        <h1 class="text-5xl md:text-7xl font-extrabold mb-4 leading-tight">{lavoro.data.title}</h1>
        <div class="flex items-center gap-4 text-stone-300">
          <span class="text-lg">Realizzato il {new Date(lavoro.data.date).toLocaleDateString('it-IT', { year: 'numeric', month: 'long' })}</span>
        </div>
      </div>
    </header>

    <article class="max-w-4xl mx-auto px-6 py-24">
      <div class="prose prose-lg prose-stone prose-headings:font-['Outfit'] prose-headings:font-bold prose-a:text-emerald-600 hover:prose-a:text-emerald-500 mx-auto">
        <Content />
      </div>
    </article>

    <div class="bg-stone-50 py-16 text-center border-t border-stone-200">
      <p class="text-stone-500 mb-4 font-medium">Ti piace questo risultato?</p>
      <h3 class="text-3xl font-bold text-stone-800 mb-8">Realizziamo lo stesso per te.</h3>
      <a href="#contatti" class="inline-block px-8 py-4 bg-stone-900 text-white font-bold rounded-full hover:bg-emerald-800 transition-all shadow-xl">
        Parliamo del tuo progetto
      </a>
    </div>

  </main>
  
  <ContactSection />

  <footer class="bg-stone-900 text-stone-500 py-10 text-center text-sm border-t border-stone-800">
    &copy; 2024 ProGreen Design.
  </footer>
</Layout>